<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>设计模式</title>
    <link href="/2023/07/31/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <url>/2023/07/31/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，您输入的密码错误，请检查后重新输入。" data-whm="抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="eef782a94b3c9fa88603f9bc8809360dca1c35644de807700db72db92d912a3f">f3558a3cfc65538cca19ad0ecdafda1a83e3a0696aaa8c8ae9b11007539f5517ae930b4facf424cbfc43c09c779318142f1441408d632e9f8a0193d719c804cc5a699d9ddeab7bfd8896ac98261cc623775440fbe9dfec5a2d9deb57b6e63f14b6ef63e487b4f225de2b8183520d31517e6fcfd3b4b069c7ccf75ecf3fed6caec21a2b02c928ff8d906776e9ad5774a19d60981c4250715848e906d31a916199778f1413ff3bc2edb46970aae9d9dfcd6570e026826ea8fbac5c9645a8a98cb2b772c31e393c7848f37cd6b41147fac6153af47170c8e4a5f8e0f75f51a77d357f65e2668b88c233c14f328258ab10ac02910610c0662becd046fef3e99bc4900c043e9c172f2372dcaec968faa3955c65a1ea691c77ba7fd7328ac771d2b53ff815b1faea300217dcb8253b050b50f6d5c5010d76c718a96b622985a3fb0c550bded507b8452d98493ae347b31bed7ef2c0828e4e9b01fbbe41ae950940d96b5d5b412eca8978c4f7e74479b7434676c236d69fdcdb878be52cb154507889cec45a9f4c41562a2bbab45130609e48396cccaf5d405aec73ca582dc0b8baf5bf721693340ba0106514fb31658eb8dc6d2e4e5d6c018ad77ea2ffa91c95a5f9ad226c61fe99a3526c2cb58e06138d4adfd2d4cef625b3e8040cc595571b0118edce6e041092893636546a7c052c3d4edce6785ae31bab1a6b18daa3bc069beec0f90c7b65c82136c9efa3e7aef1e4c3a0106ad11805b0441407ea66727a2719e50e17ce614c9f68e08c5115d4869b6eb35d43644b093dc7f54387d4f18f328853e5ac0757c5a4b28c0f6dd1ba12910d1cf43556add9943d18fdbf94bc7b7e06ac773d58eff53bf7b7742f838af621addc8a0e391c702de5326bb047d61e18db992d10928c471b12834b18d8552e95fe735d6cce361d853bab3b41c065790e1dd83126c1f9dadc905184d664f078b93c30c8d8b84dffeabd7d715b00053ea09d54565f91428a8f519776430f9d7f8881040693d4375d427d1775b668598097cc9fe869a49b0827edff258e54880093a71054c25238368737ec6fcd4cdebce7d19d86e7037ae35e8567503f8ffbdfe0a7f7a05853045142d3a968e9775110d18efbe566a26529f5df125c6621cdab221326dd1762655d3fc9f645b669eef7cf1480f384783be452fe54fb9eff95ca3df9207009bd156dd1dd2b1477172afd6ba22667d5366d807523d94678dbf252a6dd6a734de3d075e5d1881120d49f26c70d3e507dfac97c899c7013e4122d11f07348b258a24bdd2b3846a707750467e693dc6a1c17048fc8426983d4d3d8df02c803590c2f267e2c74324f25e9cf026622e4eaf028fa100945a138407a3ae64a15541e95270c74afa0cbccb4c6aec881d7ca0e757fb6e6f29d752249d4f0030f5302924461ed97d7a8fbe84f5aa5e27976ca0a5fa9d058f121571d7539a4247fb6f0bc61bd014d4714f86408b2bc8ffed20bd65b9177c41983ca920ec2fe4b9389fc6ec7cbd2571b351f701a26a7a272150a43c2d39e0a23ec2bfd7ba37390e028f0e7b9f0470d0359a90d6a05b9a4f61d603d9488b4f792eee3b0457be4308b6db52dbb8c537e2489b47d2d7528e114fbf106bc1aae61741da3ed557c765ef49a69ba2d7efce7e731c04910b6ede6994e43060808ea5e558573debbde8c868efdcd3c64dbe5af270b1e02a022aa88f722e003e31e7ebcf612efb9877d0d2a610149488fd8b69ed434e1f62fd6e1a6c196afe8c838caf04c6d9f687339602035229ab8ed00505cb69727e3c71ace403f293af9b1a2fdb2730eef1999780ba93876470eb4ce4a4960e2147f3090bc0f0cd16ac9a43fb6cdf455c9321a945b569d25d56bfb056bc6d096d73fe7301af051b12cc715888e5b4722132e8c5b75d443925fb9e4c1e696fbf9a687d51c1df6e8fb5dd5ec7716d471141a1971c6f2d1bd1ba61e75b0cbeb740514df92ccae6d70cfbdaa10566260a3b6f2eb89c898e78eefc95a15841495600686dd27dda8621cee58965fe4804f3b238973478088dd4a1731622f56f764cce3faa79128302c88b49ed039548d31b7141f9fe3b7a9d77981f5477e872678414c402f88a1fa17ba76a1b1efb8707eace173064bf93cdcf96929abc6920e0f571430d5681542dcc00c74eb1146d30c7d8a43131c2e037a99a537a9ad07d5235e3a8f01ee0e7cfe0224fc3e19e6d5483ea74deef91fd51afb5654cc586ffbf6f748bbbee2e14db916cc82b736e229cc1f10c2037c6efcee5c6ccdf0337c755b1a30461654c83773948e9553b36847d691090443f967611166d244db03f560cdcd640adcabf031b7f900bab4067fb766d0647c417637d0ebeb0b33701a1f1a32c6646db36240719fc0efb7a081874e21061015c27f4586708ddd1731f083482871a33998499d456d5e01f2eb43473fe1bc3eed253303c62ca9fe7c821542fdcbefecf8315e07a3f7ae270c0ed5817452433596e71763a1d4fc57d97aa8499e4d5ebc739a21696b9e6386ade78e9d46e2d84b189953d670b7c72aa5153494adc537c88109c6ed04be5a25d5eb807d976a9d73ae9adb0a540017c43003c2eee89669c10beed6d9c89f13eba4f61654b4d432c1ed8c86bfadf4a5822f6d6daeb8d7da4573ca4ccdb8c130aee7ed67a54b85afff23ee63537c04ac687c3193092def1363ae7e9696318d7a8c533cc6586ce1076bdb56a603809412127bcb7564db2144482eb668f032d9d3f47f78d5ec972e6cd0ae1255eb3b655dbf87b8ed01a305479c8b98896b450722e8eb6db7a1d40bda2d2823d801fa9c55dd3ae80e929caa76b629ac3896618a36a053cad4ec991c6085cf79644b06e6c772be8d936f1b1d1d38000b8486afa2005930c12aadb8fe9fdb219637b5993ef40a655c07d0b2fd18851ec11b72ededec34e41d24b277a489ff749f7fc9ce7725c1b6b8e8c897665dc05400f0d4d6126fe277a0a173db4b6a6c52c4a2656ff049363c3e0fa1e7011709565063759ea12daa9c49b47bc6d287b374ef60d2bd40f61ac68a17a9ff2c1fe118ee7ce1dd52e571fee3ccd929d251f9440c48b5591356c852dc9cfd9a729acbecc34985ddff8da1ccb445d658c24110aabffa8aab508c37437fba98548a1ba54363c4d506261d3117a54b044a91544e1e46ea307bac93ac237785b7845301e618ed1674f98145b4a5faffee0821ebfc9ef0b150a03709ce53b58a3c47dea13fcccd4c671ea038aabf1b931a024444e2eb6ad6cb44a618fd80bd3da59d5a091bf6678a0c48b7e5cce55e34fb99df32cef4e72a49a2dcc8f24849490d305e90ee0369c3ac638cdc3d51cd2149f696e24eeeeaf4e74e976e3e15aec7a1104b5c9605fb4de5cbd0ea621d48bc90fef104b6be4e8922f0ab455b60c18b15e9e831d787c6645f44e0a58793fbfa9df0661b3e868cfb0c3cafc662638c3209ba6a5864cca078084d04a03b93a44a24bc98ba27c11908e7e95bafa277ce1dc702718e6037c905bfcd9872f0dccfec07828cde7da281be7c504cfea40fe027083634ea92f3bfea2cd00ee039bdbc71957e5b341529422bda8e4a69a8bd7ba5a70c879b8dfe3015387a74bb77234ab6bc6d66a459283f2ad56cebdd47ecdc7b4da63c81621d5380b791fd42853ffa879fd299e04cfc131722cb9eda6d6be6c4f1843794fa548e0c965a2311d2c84f99ac3ad25822b5c19bcf35618e0a6d4b88dcf5033e723fc688c19da4191f306be95b532e4842a2d877ec0d11c4e93a24a1532e85d43180092118f70e668f5828926817b8747a7432b6a8ca935a177e234092b8d7fdf87708f06b1dd51d8137b77d8e0a7209f60a54499b8d99e505cee24c4178d43df33198a59c9fb1d99f62499c86a74528cd889c24b4504a691e09b1a2039359e6a8e6795cbca4966aa3fddef2a95e4f35e47d884627ab4b89c5c4f4eb0d1bfad542f97dc964c2a8b4c30f74717fa409bcbff2aee32b215d5903e6598ecb6d75cb0086069a6941ddf1a3a02766addc15ec09c19c88818be688e505821264a72968c216b6b93a135ce0403033afc135817866707a745edb23fb8b04face7cdfee161112e932e18f01ffbe9618774e0fe3149d220bf068730eeefd219592ff30af787311ad9584aecb56cb63e4e652837201c076aa0e8cfdac5f34388b0b6c40f56e8183716ac0bb2888881743ea156fd76b1ff0e5e987ae6233583d47a33c316eefe18e49ed3d622d606a3c99ef9ab661f35e6b3703cc04d78b2215620a81eba8ddad386a978de29d27992e04a60c4e5cb02bda0ea5636c5042d1161180d5a984252c532f3703ddc1d9b337dcc5ac331327eb5f5077cf3d276dff1bde178e60d44758d20ceede0d1d3f176230dcb79bdb74d676e90146032f3c1d483b1ea3b2741463798583bab8afa586a7962cf8e079b7cfbc79c04a85ccb3c036a869752b84ff52eb134145bfa0666571e32c80f815732d210f9ceac014c9182f1bda1806eee73304e0202f59cff51f120fd47b5c7bc9c0f708079638baec511c05c6c50b06a3decbe1e385c4be880647c06e4476ff77902c2bbccbde9e4ba0c00f676679e5b0a5f84acab1de8fb9f73f8a43a307883df4099ef2ea8fb04fb1e32580a17e5b28ba0c0dbbbfd9a6ea9aae2e435bf95b94dcaa794d690da042a075a332f414036d4b4347206aa12296da31f56f528aa1e42cb5b447e3b8d2cb9f158c9c424bfda7b846bf2e3ebaa5558a0dfe3b5132131e0bd059d897f48db9012d3d497f657aae53d4f6dc8559d28ec193f85ca25b41a746a56895273928cecb636c7466111521ed2632237b642cc153f86d67b7b08e4c357838f93fd8415adbd2d7c78ee36d80911a3f5907a1ecd6894533bffd3995f4c8a4f2a0daf6243266f938d858c29d497089f9bc14fe4ce4e37da7e32792edf6f0d48db2fa37d232cf2c5e87e79eb9f8923a78779bcffa8ab2ad4b2e84c70b89e2f25773894d939688bf3b07260f5d8cdbc86cfb7a83eba3d82f6d2902f2d7d809d01ffb958cc53a42982928e915b2abf14cfd1b543d9a8f9add36cb61c8817446d05868f362006d8437bdfb73d99c872ded5631c3f92bbfbdd956ab23fa43478e11c75c86971b785c784bb77ef3a823b87f7be940a630c726b7f005481384e96ead0c219384b788f4772adec3225cf772d8448ffd28bbf0191f6d9403c77ea199dd73343187d6ce67bd99c10b8a0edab59d9917d8e6f86dc9686a77a4d05631d7fc5acdf3ff11b65d9322258ff8e26bceb25300798a6741bb34c950b47d1f7d63814401d2a3eb43ab58e91b84f9095f5f219df4df48e994760e25fbfc05a683b0e1b0a809d713206bffca399e69cb76ce92b59ab02b4129327fe643e6b00d8ee150d3e5f6dd8101f10fe3b084c6013efd6649ee0ecb0f053fdd75b1f951c4eddd6c91a5068a31b48260f9d6a42f4800d68bea79d8f58910ec2d668990cf0708d301b689b7440b02f65886df83d99f227ca64b46c6ed22a53ea530c607e7836995a64cdb9fe9aa6ef0b300ded45e2f465f6ee7871d313a362073b1e3313ca34dff76bb2b7c34a79d83afc51792d8adf75299e18463a97e8482fcd4966c3fbac70946e9584557a215d213eb8f2e628af37f1696f8876a21de7d738e7c1613bd14082b9974262928294d2c26d4f7a4f3e410a03cff687d971eda35ad6ba8c66ccac508beae68ed715933ae43a471498a780768b582547aec46f80c273401d5fd1f0a14aae18d6487c74afb157a2628869a81ae1ec0f7fe9dca8a8f353c6f5d17a18824e8179fe6ee62de56c5fe56e7d882c2ce2e1638fc23fbf9f98e7bd9164697292ae0c188d6536a4f7b40908bcede6ebe5aac7391191d2190a378846dffc09de02d7d38ddea3e4f51a1a6ecb8f2750c6d7ddddd0e3ce8dbb5b624c51f0bb10ffebb0538f83603b26b78dc015e64c3aeb94ec2950bc479b91e75d313af27da61b2e934a683dfa251d769c862f0644d85ea02a51048ab172edfc2450c0c402e616a6bb82bdefdc2caa2ebc925b9d06d87bc68c2583a21516273d9b76aed87af02dddd09de50f3f3b22f934eb956b1662b27c8c5bc0817f24cf64aa8ad155fcaf38040880114f557e51c4c83115bf4473a402addd30e92e64896c8990320e482bcfc6588b495fe27cb65099c6b7c33ad65a79cdcb70687bd7fc960d7edb13bf91490750df3cf76e0721e565c2a2642aab4db3806788a5e0f8449633ee51b85a51706d2f49c521314d9ca789a750b2c6b43c670cbb3df9102b1f472a1bfeaef234a16a221021c09b70ed1e35dd49d3c63d269fa3b4723b198880e63ce0b412f592f2807d0f4f3567e1e1150ad89a72c3618140fdbb119a7c6855f4bae7413f1f9cb7d6fa33537617c43b5fb42b1e5e78be9f14a9145e32421b8622afbda1ca610f712cc915c43a6782382ccf156ca2bb56de287888651b4e15721cf87beec5e8cd43b6ac0523088b0bf1810a29759ffda2c5737fdea7dace1dbf5d4317734a0928b78dd2b4e824ae65b1ee56d354a1266d00e634034ccd4800897988cd84c3e6169489b0bfba6719696c1c34e89f83a3238d8bed57de7f11946289f5af3b95b12027af43e111552e927a17417e0ea84cbd6c4a7fd6ada5eb2334b364bc9195325690a9027acd4a3ef6b6b5ac0137932865fc2a834280257af6a836881c427e3e516c670c329e46a42ac3915bd071c103a9af15af65d27923b0679fe4d53352602168c04e462e48021801b4e88af499616415f624f150ad660ef4774bb147cebff534c37fc675cc2be320a9767ebb77f2800f9287083acff99b0ad9ff1e67a06d61810f16b065c8212eea4867cd1a46159868b77a4a58937767bade04c16cfb66b78171c4ab78ee0d557b6db6ecf55ddf8a796d72ef549300381b3ea2d6ac7ceb6ce66f52f90be91905d4834ba5d0ecd89ae553ba3e3086b676fc46262d5ea81e958550b03748e3eb69a216b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>private</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iTerm2快捷键</title>
    <link href="/2023/07/28/iTerm2%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    <url>/2023/07/28/iTerm2%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
    
    <content type="html"><![CDATA[<table><thead><tr><th>快捷键</th><th>作用说明</th></tr></thead><tbody><tr><td>command + f</td><td><strong>搜索&amp;查找</strong>，如果输入搜索内容后，按下 tab 键，就会 iTerm 自动帮选中搜索关键词，并且自动的帮我们复制到了剪贴板中。如果输入的是 shift+tab，则自动将查找内容的左边选中并复制。按 esc 退出搜索。</td></tr><tr><td>command + r  或 ctrl + l</td><td>清空屏幕，而且只是换到新一屏，不会像 clear 一样创建一个空屏</td></tr><tr><td>command + k</td><td>clear，清空屏幕</td></tr><tr><td>command + d</td><td>垂直分屏</td></tr><tr><td>command + shift + d</td><td>水平分屏</td></tr><tr><td>command + ;</td><td>查看历史命令</td></tr><tr><td>command + shift + h</td><td>查看剪贴板历史，会自动列出输入过的命令</td></tr><tr><td>command + number</td><td>tab 标签窗口来回切换</td></tr><tr><td>command + option + ←&#x2F;→  或 command + [ &#x2F; ]</td><td>切换屏幕</td></tr><tr><td>ctrl + x</td><td>第一次按时，移动光标至行首；再次按时，回到原有位置</td></tr><tr><td>ctrl + a</td><td>到行首（Ahead of line）</td></tr><tr><td>ctrl + e</td><td>到行尾（End of line）</td></tr><tr><td>ctrl + f&#x2F;b</td><td>前进后退(相当于左右方向键)</td></tr><tr><td>ctrl + u</td><td>清除当前行（无论光标在什么位置）</td></tr><tr><td>ctrl + d</td><td>删除光标当前位置的<strong>字符</strong></td></tr><tr><td>ctrl + h</td><td>删除光标之前的<strong>字符</strong></td></tr><tr><td>ctrl + w</td><td>删除光标之前的<strong>单词</strong></td></tr><tr><td>ctrl + k</td><td>删除光标当前位置到文本末尾的<strong>所有字符</strong></td></tr><tr><td>ctrl + t</td><td>交换光标当前位置的字符与前一个字符的位置</td></tr><tr><td>ctrl + c  或 ctrl + j  或 ctrl + o</td><td>取消当前行输入的命令（中断操作）。重新起一行。</td></tr><tr><td>ctrl + y</td><td>粘贴之前（ctrl +u&#x2F;k&#x2F;w）删除的内容</td></tr><tr><td>ctrl + p  或 !!</td><td>上一条命令。调出命令历史中的前一条（Previous）命令，相当于通常的上箭头</td></tr><tr><td>ctrl + n</td><td>下一条命令。调出命令历史中的下一条（Next）命令，相当于通常的上箭头</td></tr><tr><td>ctrl + s</td><td>冻结终端操作（暂停脚本）</td></tr><tr><td>ctrl + q</td><td>恢复冻结（继续执行脚本）</td></tr><tr><td>ctrl + r</td><td>搜索命令历史。根据用户输入查找相关历史命令（reverse-i-search</td></tr><tr><td>ctrl + l  或 command + r</td><td>换到新一屏，创建一个空屏</td></tr><tr><td>ctrl + i  或 tab</td><td>横行制表符，在命令行中补齐指令</td></tr><tr><td>双击</td><td>选中单词</td></tr><tr><td>三击</td><td>选中整行</td></tr><tr><td>四击</td><td>智能选择</td></tr><tr><td>!word</td><td>重复运行最近一条以“word”开头的指令，如!ls 或 !l</td></tr><tr><td>!$</td><td>调用上一条指令的最后一个参数作为当前指令对象,如，假设上一条指令为： ls abc.txt bbc.txt 那么， vi !$ 相当于： vi bbc.txt</td></tr><tr><td>!number</td><td>调用执行指定编号的历史记录指令,如!2, !11</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>“技巧”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>“技巧”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>异步编程</title>
    <link href="/2023/07/27/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"/>
    <url>/2023/07/27/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="python-asyncio并发编程"><a href="#python-asyncio并发编程" class="headerlink" title="python asyncio并发编程"></a>python asyncio并发编程</h1><h3 id="asyncio基础"><a href="#asyncio基础" class="headerlink" title="asyncio基础"></a>asyncio基础</h3><h4 id="1-通过任务实现并发"><a href="#1-通过任务实现并发" class="headerlink" title="1.通过任务实现并发"></a>1.通过任务实现并发</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">delay</span>(<span class="hljs-params">delay_seconds: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;等待<span class="hljs-subst">&#123;delay_seconds&#125;</span>秒&quot;</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(delay_seconds)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;完成等待<span class="hljs-subst">&#123;delay_seconds&#125;</span>秒&quot;</span>)<br>    <span class="hljs-keyword">return</span> delay_seconds<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> delay<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_every_second</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;我在等待时正在运行其他代码&#x27;</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    fist_delay = asyncio.create_task(delay(<span class="hljs-number">3</span>))<br>    second_delay = asyncio.create_task(delay(<span class="hljs-number">3</span>))<br>    <span class="hljs-keyword">await</span> hello_every_second()<br>    <span class="hljs-keyword">await</span> fist_delay<br>    <span class="hljs-keyword">await</span> second_delay<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    asyncio.run(main())<br><br></code></pre></td></tr></table></figure><p>代码时间运行过程:</p><p><img src="https://raw.githubusercontent.com/ai-Iverson/images/main/202307271751241.png"></p><h4 id="2-取消任务和设置超时"><a href="#2-取消任务和设置超时" class="headerlink" title="2.取消任务和设置超时"></a>2.取消任务和设置超时</h4><ul><li><p>取消任务</p><p>每个任务对象都有一个名为cancel的方法,可以想要停止任务时调用它,取消一个任务将导致该任务在执行await时引发CancelledErrorr然后可以根据需要处理它</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> asyncio <span class="hljs-keyword">import</span> CancelledError<br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> delay<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    long_task = asyncio.create_task(delay(<span class="hljs-number">10</span>))<br><br>    second_elapsed = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> long_task.done():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;任务未完成&quot;</span>)<br>        <span class="hljs-comment"># await 会触发其他时间循环中的task执行</span><br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>        second_elapsed = second_elapsed + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> second_elapsed == <span class="hljs-number">5</span>:<br>            long_task.cancel()<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">await</span> long_task<br>    <span class="hljs-keyword">except</span> CancelledError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;任务取消&quot;</span>)<br><br><br>asyncio.run(main())<br><br></code></pre></td></tr></table></figure><p>我们创建了一个任务，它将花费10 秒的时间来运行。然后 创建 一个while循环来检查该任务是否已完成。任务的done方法在任务完成时返回 True，否则返回False。每 一秒，我们检查任务是否已经完成，并记录到目前为止经历 了多少秒。如果任务已经花费了5秒，就取消这个任务。然后来到await long task，将输出任务取消 ， 这 表 明 捕 获 了一 个 CancelledError</p></li><li><p>使用wait_for设置超时任务取消</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> delay<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    delay_task = asyncio.create_task(delay(<span class="hljs-number">2</span>))<br>    <span class="hljs-keyword">try</span>:<br>        result = <span class="hljs-keyword">await</span> asyncio.wait_for(delay_task, timeout=<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(result)<br>    <span class="hljs-keyword">except</span> asyncio.exceptions.TimeoutError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;任务超时&quot;</span>)<br><br><br>asyncio.run(main())<br><br></code></pre></td></tr></table></figure></li><li><p>使用asyncio.shield保护任务免于取消</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    delay_task = asyncio.create_task(delay(<span class="hljs-number">2</span>))<br>    <span class="hljs-keyword">try</span>:<br>        result = <span class="hljs-keyword">await</span> asyncio.wait_for(asyncio.shield(delay_task), timeout=<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(result)<br>    <span class="hljs-keyword">except</span> asyncio.exceptions.TimeoutError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;任务超时&quot;</span>)<br>        result = <span class="hljs-keyword">await</span> delay_task<br>        <span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure></li></ul><h4 id="3-任务-协程-future和awaitable"><a href="#3-任务-协程-future和awaitable" class="headerlink" title="3.任务,协程,future和awaitable"></a>3.任务,协程,future和awaitable</h4><ul><li><p>什么是future?</p><ul><li>future 是一个 Python 对象，它包含一个你希望在未来某个时间点获得但目前可能 还不存在的值。通常，当创建future 时，它没有任何值，因为它还不存在。在这种状 态下，它被认为是不完整的、未解决的或根本没有完成的。然后， 一旦你得到 一个结 果，就可以设置future 的值，这将完成future。那时，我们可以认为它已经完成,并可 从 future提取结果</li></ul></li><li><p>等待一个future</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> asyncio <span class="hljs-keyword">import</span> Future<br><span class="hljs-keyword">import</span> asyncio<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_future_value</span>(<span class="hljs-params">future</span>) -&gt; <span class="hljs-literal">None</span>:<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>    future.set_result(<span class="hljs-number">42</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_request</span>() -&gt; Future:<br>    future = Future()<br>    asyncio.create_task(set_future_value(future))<br>    <span class="hljs-keyword">return</span> future<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    future = make_request()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;future is done? <span class="hljs-subst">&#123;future.done()&#125;</span>&quot;</span>)<br>    value = <span class="hljs-keyword">await</span> future<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;future is done? <span class="hljs-subst">&#123;future.done()&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(value)<br><br><br>asyncio.run(main())<br></code></pre></td></tr></table></figure></li><li><p>Future ,任务和协程之间的关系</p><p><img src="https://raw.githubusercontent.com/ai-Iverson/images/main/202307271751260.png"></p></li></ul><p>​创建一个任务时,我们正在创建一个空future,并运行协程,当协程以得到结果或异常结束时,我们将设置future的结果或异常</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
